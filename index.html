<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Code Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Html5 QR Code Library -->
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

  <style>
    /* Responsive scanner wrapper */
    #reader {
      display: none;
    }

    /* Fixed position for Stop button */
    #stop-scanner {
      display: none;
      position: fixed;
      top: 15px;
      right: 15px;
      z-index: 1000;
    }

    #input-field {
      display: flex;
      height: 100%;
    }

    body{
      height: 100vh;
    }
  </style>
</head>
<body>

  <!-- Input field -->
  <div id="input-field" class="m-5 align-items-center">
    <div class="text-center w-100">
      <h2 class="mb-4">QR Code Scanner</h2>
      <div class="input-group mb-3">
        <input type="text" class="form-control" placeholder="Scan result" id="scan-result" readonly>
        <button class="btn btn-outline-primary" type="button" id="start-scanner">
          <i class="bi bi-camera"></i>
        </button>
      </div>
    </div>
  </div>
  

  <!-- QR Reader Container -->
  <div id="reader"></div>

  <!-- Stop Button -->
  <button id="stop-scanner" class="btn btn-danger">
    <i class="bi bi-x-circle"></i> Stop
  </button>

  <script>
    const inputField = document.getElementById("input-field");
    const startBtn = document.getElementById("start-scanner");
    const stopBtn = document.getElementById("stop-scanner");
    const resultInput = document.getElementById("scan-result");
    const readerDiv = document.getElementById("reader");

    let html5QrCode;

    startBtn.addEventListener("click", () => {
      Html5Qrcode.getCameras().then(cameras => {
        if (cameras && cameras.length > 0) {
          const cameraId = cameras[0].id;
          html5QrCode = new Html5Qrcode("reader");

          const qrBoxSize = 400
          const width = window.innerWidth
          const height = window.innerHeight
          const aspectRatio = width / height
          const config = {
            fps: 20, // frame per seconds for qr code scanning
            aspectRatio,
            qrbox: { width: 250, height: 250},
          }


          readerDiv.style.display = "flex";
          stopBtn.style.display = "block";
          inputField.style.display = "none";
          startBtn.disabled = true;
          stopBtn.disabled = false;

          html5QrCode.start(
            cameraId,
            config,
            qrMessage => {
              resultInput.value = qrMessage;

              html5QrCode.stop().then(() => {
                html5QrCode.clear();
                readerDiv.style.display = "none";
                stopBtn.style.display = "none";
                inputField.style.display = "flex";
                startBtn.disabled = false;
                stopBtn.disabled = true;
              }).catch(err => console.error("Stop error:", err));
            },
            errorMessage => {
              // Optional: console.log("Scan error:", errorMessage);
            }
          ).catch(err => {
            console.error("Start scan error:", err);
            resultInput.value = "❌ Error: " + err;
          });

        } else {
          resultInput.value = "❌ No camera found";
        }
      }).catch(err => {
        resultInput.value = "❌ Camera access error";
        console.error("Camera access error:", err);
      });
    });

    stopBtn.addEventListener("click", () => {
      if (html5QrCode) {
        html5QrCode.stop().then(() => {
          html5QrCode.clear();
          readerDiv.style.display = "none";
          stopBtn.style.display = "none";
          inputField.style.display = "flex";
          startBtn.disabled = false;
          stopBtn.disabled = true;
        }).catch(err => {
          console.error("Stop scan error:", err);
        });
      }
    });
  </script>
</body>
</html>
